<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>C&W Story Tracker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='mobile.css') }}" media="(max-width:760px)">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='ccp.ico') }}">
</head>
<body>

<div class="user-box">
  <span class="greeting">Hello, {{ current_user.name }}!</span>
      {% if current_user.is_authenticated and current_user.email in ALLOWED_EMAILS %}
        <a href="{{ url_for('manage') }}" class="manage-form">
            <button type="button" class="settings-btn">⚙</button>
        </a>
    {% endif %}
  <form action="{{ url_for('logout') }}" method="get">
    <button type="submit">Logout</button>
  </form>
</div>



    <div style="display: flex; justify-content: center; align-items: center;">
    <h1 style="display: inline;"><a href="https://www.ccpstudentnews.org" style="font-family: 'Brush Script MT'; text-decoration: none; color: #222; font-size: 45px;">Cardinal and White&nbsp; </a></h1><h1 style="display: inline;">Story Tracker</h1>
    </div>
   

    <form method="POST" class="typ" action="/add">
        <input type="text" name="title" placeholder="Article Title" required>
        <input type="text" name="author" placeholder="Author Name" required>
        <select id="cat" name="cat">
          <option value="F">-- Type --</option>
          <option value="F">Features</option>
          <option value="N">News</option>
          <option value="O">Opinion</option>
          <option value="S">Sports</option>
        </select>
        <input type="date" name="deadline">
        <button type="submit">Add Article</button>
    </form>


<table>
  <thead>
    <tr>
      <th class="drag-handle"> </th> 
      <th class="cat">Type</th>
      <th class="title">Title</th>
      <th class="author">Author</th>
      <th class="status">Status</th>
      <th class="editor">Editor</th>
      <th class="deadline">Deadline</th>
      <th class="filescol">Files</th>
      <th class="actions">Actions</th>
    </tr>
  </thead>
  <tbody id="articles-tbody">
  {% for article in articles %}
    <tr id="row-{{ article.id }}" data-id="{{ article.id }}" class="{% if article.status == 'Published' %}published{% endif %}">
      <td class="drag-handle" style="cursor: grab;">☰</td>
      <td class="cat">
        <select onchange="updateCat({{ article.id }}, this.value)" {% if article.status == 'Published' %}disabled{% endif %}>
          <option value="F" {% if article.cat == 'F' %}selected{% endif %}>F</option>
          <option value="N" {% if article.cat == 'N' %}selected{% endif %}>N</option>
          <option value="O" {% if article.cat == 'O' %}selected{% endif %}>O</option>
          <option value="S" {% if article.cat == 'S' %}selected{% endif %}>S</option>
      </td>
      <td class="title">{{ article.title }}</td>
      <td class="author">{{ article.author }}</td>
            <td class="status">
                <button class="status-button" onclick="openStatusModal({{ article.id }}, '{{ article.status }}')">
                    {{ article.status }}
                </button>
                <button class="status-color {% if article.status_color == 'red' %}red{% elif article.status_color == 'yellow' %}yellow{% else %}white{% endif %}" aria-label="Status Color" onclick="cycleStatusColor({{ article.id }}, event)"></button>
            </td>
      <td class="editor">
  <select onchange="updateEditor({{ article.id }}, this.value)" {% if article.status == 'Published' %}disabled{% endif %}>
    <option value="">-- Select --</option>
    <option value="Copley" {% if article.editor == 'Copley' %}selected{% endif %}>Copley</option>
    <option value="Lewis" {% if article.editor == 'Lewis' %}selected{% endif %}>Lewis</option>
  </select>
</td>

      <td class="deadline" data-deadline="{{ article.deadline }}">{{ article.deadline }}</td>

      <td class="filescol">
        <button class="file-icon-btn" onclick="openFileManager({{ article.id }})">Files</button>
      </td>

      <td class="actions">
        {% if article.status == 'Published' %}
            <button onclick="markComplete({{ article.id }})" style="color:green;">Mark Complete</button>
        {% else %}
            <button onclick="toggleEdit({{ article.id }})" id="edit-btn-{{ article.id }}">Edit</button>
            <button onclick="deleteArticle({{ article.id }})" style="color:red;">Delete</button>
        {% endif %}
    </td>

    </tr>
  {% endfor %}
  </tbody>
</table>



<div id="fileManagerModal" class="modal" aria-hidden="true">
  <div class="modal-content">
    <button type="button" class="close" aria-label="Close" onclick="closeFileManager()">×</button>

    <h3>Files</h3>

    <ul id="fileList" class="file-list"></ul>
    <div class="upload-section">
      <form id="uploadForm" class="typ" enctype="multipart/form-data">
        <input type="file" name="file" id="fileInput" required />
        <button type="submit">Upload</button>
      </form>
    </div>
  </div>
</div>

<div id="statusModal" class="status-modal" aria-hidden="true">
  <div class="status-modal-content">
    <button type="button" class="status-modal-close" aria-label="Close" onclick="closeStatusModal()">×</button>
    <h3>Status</h3>
    <div class="status-timeline" id="statusTimeline">
    </div>
  </div>
</div>

<div class="footerbut" style="display: flex; justify-content: center; align-items: center; margin: 20px; gap: 15px;">
    <a href="{{ url_for('archived') }}">View Archived Articles</a>

    <a href="{{ url_for('calendar') }}">
        <img src="{{ url_for('static', filename='calendar.png') }}" alt="Calendar" style="width: 18px; height: 18px;">
    </a>
</div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

<script src="{{ url_for('static', filename='status-modal.js') }}"></script>
<script src="{{ url_for('static', filename='article-manager.js') }}"></script>
<script src="{{ url_for('static', filename='file-manager.js') }}"></script>
<script src="{{ url_for('static', filename='socket-manager.js') }}"></script>
<script src="{{ url_for('static', filename='drag-sort.js') }}"></script>
<script src="{{ url_for('static', filename='tooltip.js') }}"></script>

</body>
</html>
